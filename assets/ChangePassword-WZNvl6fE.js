import{d as _,m as h,r as c,o as b,g as y,E as n,b as C,p as x,c as m,C as E,a as s,t as M,w as p,v as f,D as g,G as V,e as v}from"./index-CD6pE5kN.js";import{_ as k}from"./_plugin-vue_export-helper-DlAUqK2U.js";const A={class:"page"},B={key:0,class:"warning-banner"},K={class:"box"},R={class:"row"},D={class:"field"},N={class:"row"},S={class:"field"},T={class:"row row-last"},U={class:"field"},G={class:"btn-row"},W=["disabled"],q=_({__name:"ChangePassword",setup(F){const P=y(),d=C(),r=h(),u=c(!1),t=c("");b(()=>{if(P.query.preview==="1"){u.value=!1,t.value="";return}if(!r.isAuthenticated)n.warning("请先登录"),d.push("/member/login");else if(r.user?.needPasswordChange){u.value=!0;const a=r.user?.loginCountWithoutChange||1;a===1?t.value="⚠️ 首次登录，为了您的账户安全，请立即修改初始密码！":a>=2?t.value="⚠️ 严重警告：这是您第"+a+"次登录未修改密码，再次登录未修改将立即停用账户！":t.value="⚠️ 请立即修改您的初始密码"}});const o=x({oldPassword:"",newPassword:"",confirmPassword:""}),w=c(!1),i=async()=>{if(!o.oldPassword){n.warning("请输入原始密码");return}if(!o.newPassword){n.warning("请输入新密码");return}if(!o.confirmPassword){n.warning("请输入确认密码");return}if(o.newPassword!==o.confirmPassword){n.error("两次输入的密码不一致");return}if(o.newPassword.length<6){n.warning("新密码至少6位");return}w.value=!0;try{const a=await V.changePassword({oldPassword:o.oldPassword,newPassword:o.newPassword});if(a.code===200){n.success("密码修改成功，请重新登录"),o.oldPassword="",o.newPassword="",o.confirmPassword="";const e=r.user?.role;r.logout(),setTimeout(()=>{e==="AGENT"?d.push("/agent/login"):d.push("/member/login")},1e3)}else n.error(a.message||"密码修改失败")}catch(a){const e=a.response?.data?.message||"密码修改失败";n.error(e)}finally{w.value=!1}};return(a,e)=>(v(),m("div",A,[u.value?(v(),m("div",B,M(t.value),1)):E("",!0),s("div",K,[e[6]||(e[6]=s("div",{class:"header",align:"center"},[s("span",{class:"title-text"}," 修改密码 ")],-1)),s("div",R,[e[3]||(e[3]=s("div",{class:"label"},[s("span",{class:"red"},"*"),s("span",{class:"label-text"},"原始密码:")],-1)),s("div",D,[p(s("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>o.oldPassword=l),type:"password",class:"input",onKeyup:g(i,["enter"])},null,544),[[f,o.oldPassword]])])]),s("div",N,[e[4]||(e[4]=s("div",{class:"label"},[s("span",{class:"red"},"*"),s("span",{class:"label-text"},"新设密码:")],-1)),s("div",S,[p(s("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>o.newPassword=l),type:"password",class:"input",onKeyup:g(i,["enter"])},null,544),[[f,o.newPassword]])])]),s("div",T,[e[5]||(e[5]=s("div",{class:"label"},[s("span",{class:"red"},"*"),s("span",{class:"label-text"},"确认密码:")],-1)),s("div",U,[p(s("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>o.confirmPassword=l),type:"password",class:"input",onKeyup:g(i,["enter"])},null,544),[[f,o.confirmPassword]])])]),s("div",G,[s("button",{class:"btn btn1",disabled:w.value,onClick:i},"修改密码",8,W)])])]))}}),z=k(q,[["__scopeId","data-v-f000791c"]]);export{z as default};
