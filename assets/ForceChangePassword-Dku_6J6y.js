import{d as M,m as P,r as l,g as V,o as U,c as C,a as s,n as r,w as i,v as u,H as x,F as S,l as T,t as A,B as R,E as o,I as N,b as I,A as q,e as y}from"./index-DKR1vezK.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";const z={class:"page"},H={class:"box"},L={class:"row"},j={class:"field"},J={class:"row"},K={class:"field"},O={class:"row"},Q={class:"field"},W={class:"row"},X={class:"field"},Y={class:"row"},Z={class:"field"},$={class:"row row-last"},ss={class:"field captcha-field"},es={class:"btn-row"},as=["disabled"],ts=M({__name:"ForceChangePassword",setup(ls){const b=V(),_=I(),k=P(),c=l(b.query.username||""),p=l((b.query.role||"MEMBER").toUpperCase()),v=l(""),n=l(""),w=l(""),g=l(""),m=l(""),d=l(""),E=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD"],f=l(!1),D=t=>E[t%E.length],h=async()=>{try{const t=await R.getCaptcha();t.code===200&&(g.value=t.data.code,m.value=t.data.token,d.value="")}catch{g.value="",m.value="",o.error("验证码加载失败")}},F=async()=>{if(!c.value.trim())return o.warning("请输入账号");if(!v.value.trim())return o.warning("请输入原始密码");if(!n.value.trim())return o.warning("请输入新密码");if(n.value.length<6)return o.warning("新密码至少6位");if(n.value!==w.value)return o.error("两次输入的密码不一致");if(!d.value.trim())return o.warning("请输入验证码");if(!m.value)return o.warning("验证码未加载，请刷新");f.value=!0;try{const t=await N.forceChangePassword({username:c.value.trim(),role:p.value,oldPassword:v.value,newPassword:n.value,captchaToken:m.value,captchaCode:d.value.trim()});t.code===200&&(o.success("密码修改成功，账号已解锁"),k.setSession(t.data),p.value==="AGENT"?_.push("/member"):_.push("/user-agreement"))}catch{h()}finally{f.value=!1}};return U(()=>{document.title="强制修改密码";const t=document.getElementById("favicon");t&&(t.href="/favicon.png"),h()}),(t,e)=>(y(),C("div",z,[s("div",H,[e[13]||(e[13]=s("div",{class:"header"},"强制修改密码（解锁账号）",-1)),e[14]||(e[14]=s("div",{class:"tip"}," 账号因连续未修改初始密码被停用时，请在这里修改密码解锁。 ",-1)),s("div",L,[e[6]||(e[6]=s("div",{class:"label"},[s("span",{class:"red"},"*"),r("账号:")],-1)),s("div",j,[i(s("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>c.value=a),class:"input",placeholder:"请输入账号"},null,512),[[u,c.value]])])]),s("div",J,[e[8]||(e[8]=s("div",{class:"label"},[s("span",{class:"red"},"*"),r("角色:")],-1)),s("div",K,[i(s("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>p.value=a),class:"input"},[...e[7]||(e[7]=[s("option",{value:"MEMBER"},"会员",-1),s("option",{value:"AGENT"},"代理",-1)])],512),[[x,p.value]])])]),s("div",O,[e[9]||(e[9]=s("div",{class:"label"},[s("span",{class:"red"},"*"),r("原始密码:")],-1)),s("div",Q,[i(s("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>v.value=a),type:"password",class:"input",placeholder:"请输入原始密码"},null,512),[[u,v.value]])])]),s("div",W,[e[10]||(e[10]=s("div",{class:"label"},[s("span",{class:"red"},"*"),r("新设密码:")],-1)),s("div",X,[i(s("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>n.value=a),type:"password",class:"input",placeholder:"至少6位"},null,512),[[u,n.value]])])]),s("div",Y,[e[11]||(e[11]=s("div",{class:"label"},[s("span",{class:"red"},"*"),r("确认密码:")],-1)),s("div",Z,[i(s("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>w.value=a),type:"password",class:"input",placeholder:"再次输入新密码"},null,512),[[u,w.value]])])]),s("div",$,[e[12]||(e[12]=s("div",{class:"label"},[s("span",{class:"red"},"*"),r("验证码:")],-1)),s("div",ss,[i(s("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>d.value=a),class:"input captcha-input",placeholder:"验证码",maxlength:"4"},null,512),[[u,d.value]]),s("div",{class:"captcha-display",onClick:h},[(y(!0),C(S,null,T(g.value,(a,B)=>(y(),C("span",{key:B,class:"captcha-char",style:q({color:D(B)})},A(a),5))),128))])])]),s("div",es,[s("button",{class:"btn",disabled:f.value,onClick:F},A(f.value?"处理中...":"修改并解锁"),9,as)])])]))}}),rs=G(ts,[["__scopeId","data-v-06630281"]]);export{rs as default};
