import{d as P,m as _,r as w,o as h,E as n,b,p as y,c as m,C,a as s,t as x,w as c,v as p,D as f,G as E,e as v}from"./index-DcramZYa.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";const V={class:"page"},k={key:0,class:"warning-banner"},A={class:"box"},B={class:"row"},K={class:"field"},D={class:"row"},N={class:"field"},R={class:"row row-last"},S={class:"field"},T={class:"btn-row"},U=["disabled"],G=P({__name:"ChangePassword",setup(W){const l=b(),t=_(),g=w(!1),d=w("");h(()=>{if(!t.isAuthenticated)n.warning("请先登录"),l.push("/member/login");else if(t.user?.needPasswordChange){g.value=!0;const a=t.user?.loginCountWithoutChange||1;a===1?d.value="⚠️ 首次登录，为了您的账户安全，请立即修改初始密码！":a>=2?d.value="⚠️ 严重警告：这是您第"+a+"次登录未修改密码，再次登录未修改将立即停用账户！":d.value="⚠️ 请立即修改您的初始密码"}});const o=y({oldPassword:"",newPassword:"",confirmPassword:""}),u=w(!1),i=async()=>{if(!o.oldPassword){n.warning("请输入原始密码");return}if(!o.newPassword){n.warning("请输入新密码");return}if(!o.confirmPassword){n.warning("请输入确认密码");return}if(o.newPassword!==o.confirmPassword){n.error("两次输入的密码不一致");return}if(o.newPassword.length<6){n.warning("新密码至少6位");return}u.value=!0;try{const a=await E.changePassword({oldPassword:o.oldPassword,newPassword:o.newPassword});if(a.code===200){n.success("密码修改成功，请重新登录"),o.oldPassword="",o.newPassword="",o.confirmPassword="";const e=t.user?.role;t.logout(),setTimeout(()=>{e==="AGENT"?l.push("/agent/login"):l.push("/member/login")},1e3)}else n.error(a.message||"密码修改失败")}catch(a){const e=a.response?.data?.message||"密码修改失败";n.error(e)}finally{u.value=!1}};return(a,e)=>(v(),m("div",V,[g.value?(v(),m("div",k,x(d.value),1)):C("",!0),s("div",A,[e[6]||(e[6]=s("div",{class:"header",align:"center"},[s("span",{class:"title-text"}," 修改密码 ")],-1)),s("div",B,[e[3]||(e[3]=s("div",{class:"label"},[s("span",{class:"red"},"*"),s("span",{class:"label-text"},"原始密码:")],-1)),s("div",K,[c(s("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>o.oldPassword=r),type:"password",class:"input",onKeyup:f(i,["enter"])},null,544),[[p,o.oldPassword]])])]),s("div",D,[e[4]||(e[4]=s("div",{class:"label"},[s("span",{class:"red"},"*"),s("span",{class:"label-text"},"新设密码:")],-1)),s("div",N,[c(s("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>o.newPassword=r),type:"password",class:"input",onKeyup:f(i,["enter"])},null,544),[[p,o.newPassword]])])]),s("div",R,[e[5]||(e[5]=s("div",{class:"label"},[s("span",{class:"red"},"*"),s("span",{class:"label-text"},"确认密码:")],-1)),s("div",S,[c(s("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>o.confirmPassword=r),type:"password",class:"input",onKeyup:f(i,["enter"])},null,544),[[p,o.confirmPassword]])])]),s("div",T,[s("button",{class:"btn btn1",disabled:u.value,onClick:i},"修改密码",8,U)])])]))}}),j=M(G,[["__scopeId","data-v-cfe600fa"]]);export{j as default};
