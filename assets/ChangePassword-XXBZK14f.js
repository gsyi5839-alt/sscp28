import{d as f,m,o as P,g,E as a,b as v,p as _,r as b,c as h,a as s,w,v as u,C as c,D as y,e as x}from"./index-CujNHOTE.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";const E={class:"page"},M={class:"box"},A={class:"row"},B={class:"field"},K={class:"row"},R={class:"field"},V={class:"row row-last"},k={class:"field"},T={class:"btn-row"},U=["disabled"],D=f({__name:"ChangePassword",setup(N){const p=g(),t=v(),l=m();P(()=>{p.query.preview!=="1"&&(l.isAuthenticated||(a.warning("请先登录"),t.push("/member/login")))});const o=_({oldPassword:"",newPassword:"",confirmPassword:""}),i=b(!1),d=async()=>{if(!o.oldPassword){a.warning("请输入原始密码");return}if(!o.newPassword){a.warning("请输入新密码");return}if(!o.confirmPassword){a.warning("请输入确认密码");return}if(o.newPassword!==o.confirmPassword){a.error("两次输入的密码不一致");return}if(o.newPassword.length<6){a.warning("新密码至少6位");return}i.value=!0;try{const r=await y.changePassword({oldPassword:o.oldPassword,newPassword:o.newPassword});if(r.code===200){a.success("密码修改成功，请重新登录"),o.oldPassword="",o.newPassword="",o.confirmPassword="";const e=l.user?.role;l.logout(),setTimeout(()=>{e==="AGENT"?t.push("/agent/login"):t.push("/member/login")},1e3)}else a.error(r.message||"密码修改失败")}catch(r){const e=r.response?.data?.message||"密码修改失败";a.error(e)}finally{i.value=!1}};return(r,e)=>(x(),h("div",E,[s("div",M,[e[6]||(e[6]=s("div",{class:"header",align:"center"},[s("span",{class:"title-text"}," 修改密码 ")],-1)),s("div",A,[e[3]||(e[3]=s("div",{class:"label"},[s("span",{class:"red"},"*"),s("span",{class:"label-text"},"原始密码:")],-1)),s("div",B,[w(s("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>o.oldPassword=n),type:"password",class:"input",onKeyup:c(d,["enter"])},null,544),[[u,o.oldPassword]])])]),s("div",K,[e[4]||(e[4]=s("div",{class:"label"},[s("span",{class:"red"},"*"),s("span",{class:"label-text"},"新设密码:")],-1)),s("div",R,[w(s("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>o.newPassword=n),type:"password",class:"input",onKeyup:c(d,["enter"])},null,544),[[u,o.newPassword]])])]),s("div",V,[e[5]||(e[5]=s("div",{class:"label"},[s("span",{class:"red"},"*"),s("span",{class:"label-text"},"确认密码:")],-1)),s("div",k,[w(s("input",{"onUpdate:modelValue":e[2]||(e[2]=n=>o.confirmPassword=n),type:"password",class:"input",onKeyup:c(d,["enter"])},null,544),[[u,o.confirmPassword]])])]),s("div",T,[s("button",{class:"btn btn1",disabled:i.value,onClick:d},"修改密码",8,U)])])]))}}),F=C(D,[["__scopeId","data-v-dfcc30ad"]]);export{F as default};
