import{d as C,m as E,r as f,o as x,E as r,b as M,p as N,c as g,C as b,a as s,t as c,u as t,i as V,j as k,k as A,n as p,w as m,v,D as _,G as T,e as P}from"./index-Bxis9ZRH.js";import{_ as B}from"./_plugin-vue_export-helper-DlAUqK2U.js";const G={class:"page"},K={key:0,class:"warning-banner"},R={class:"warning-content"},D={class:"box"},S={key:0,class:"user-info"},U={class:"info-value"},W={class:"info-value"},j={class:"row"},z={class:"field"},F={class:"row"},I={class:"field"},q={class:"row row-last"},H={class:"field"},J={class:"btn-row"},L=["disabled"],O=C({__name:"ChangePassword",setup(Q){const d=M(),a=E(),h=f(!1),i=f("");x(()=>{if(!a.isAuthenticated)r.warning("请先登录"),d.push("/member/login");else if(a.user?.needPasswordChange){h.value=!0;const n=a.user?.loginCountWithoutChange||1;n===1?i.value="⚠️ 首次登录，为了您的账户安全，请立即修改初始密码！":n>=2?i.value="⚠️ 严重警告：这是您第"+n+"次登录未修改密码，再次登录未修改将立即停用账户！":i.value="⚠️ 请立即修改您的初始密码"}});const o=N({oldPassword:"",newPassword:"",confirmPassword:""}),u=f(!1),w=async()=>{if(!o.oldPassword){r.warning("请输入原始密码");return}if(!o.newPassword){r.warning("请输入新密码");return}if(!o.confirmPassword){r.warning("请输入确认密码");return}if(o.newPassword!==o.confirmPassword){r.error("两次输入的密码不一致");return}if(o.newPassword.length<6){r.warning("新密码至少6位");return}u.value=!0;try{const n=await T.changePassword({oldPassword:o.oldPassword,newPassword:o.newPassword});if(n.code===200){r.success("密码修改成功，请重新登录"),o.oldPassword="",o.newPassword="",o.confirmPassword="";const e=a.user?.role;a.logout(),setTimeout(()=>{e==="AGENT"?d.push("/agent/login"):d.push("/member/login")},1e3)}else r.error(n.message||"密码修改失败")}catch(n){const e=n.response?.data?.message||"密码修改失败";r.error(e)}finally{u.value=!1}};return(n,e)=>{const y=A("el-tag");return P(),g("div",G,[h.value?(P(),g("div",K,[s("div",R,c(i.value),1)])):b("",!0),s("div",D,[e[8]||(e[8]=s("div",{class:"header"},"修改密码",-1)),t(a).user?(P(),g("div",S,[e[3]||(e[3]=s("span",{class:"info-label"},"当前账号：",-1)),s("span",U,c(t(a).user.username),1),e[4]||(e[4]=s("span",{class:"info-label",style:{"margin-left":"20px"}},"角色：",-1)),s("span",W,[V(y,{type:t(a).user.role==="AGENT"?"danger":"success",size:"small"},{default:k(()=>[p(c(t(a).user.role==="AGENT"?"代理":t(a).user.role==="MEMBER"?"会员":t(a).user.role),1)]),_:1},8,["type"])])])):b("",!0),s("div",j,[e[5]||(e[5]=s("div",{class:"label"},[s("span",{class:"red"},"*"),p("原始密码:")],-1)),s("div",z,[m(s("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>o.oldPassword=l),type:"password",class:"input",placeholder:"请输入原始密码",onKeyup:_(w,["enter"])},null,544),[[v,o.oldPassword]])])]),s("div",F,[e[6]||(e[6]=s("div",{class:"label"},[s("span",{class:"red"},"*"),p("新设密码:")],-1)),s("div",I,[m(s("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>o.newPassword=l),type:"password",class:"input",placeholder:"至少6位",onKeyup:_(w,["enter"])},null,544),[[v,o.newPassword]])])]),s("div",q,[e[7]||(e[7]=s("div",{class:"label"},[s("span",{class:"red"},"*"),p("确认密码:")],-1)),s("div",H,[m(s("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>o.confirmPassword=l),type:"password",class:"input",placeholder:"再次输入新密码",onKeyup:_(w,["enter"])},null,544),[[v,o.confirmPassword]])])]),s("div",J,[s("button",{class:"btn",disabled:u.value,onClick:w},c(u.value?"处理中...":"修改密码"),9,L)])])])}}}),Z=B(O,[["__scopeId","data-v-71320701"]]);export{Z as default};
